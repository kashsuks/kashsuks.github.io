<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kashyap S</title>
  <link rel="stylesheet" href="https://mhs-webring.netlify.app/onionring.css">
</head>
<body>
  <p>Hey there! I'm Kashyap :p</p>
  
  <p>I began coding since I was 10 and it's best thing that has happened to me. I'm continuing what I enjoy doing @ <a href="https://hackclub.com">hack club</a></p>

  <p>I am probably:</p>
  <ul>
    <li>Solving a leetcode problem</li>
    <li>Shipping some project</li>
    <li>Listening to music</li>
    <li>Doomscrolling</li>
  </ul>
  
  <p id="lastfm-stats">Loading music stats...</p>
  <p id="github-stats">Loading commit stats...</p>

  <p>Feel free to contact me: kashyap(at)hackclub(dot)help</p>

  <p>My hate for css is what caused this site</p>

  <script src="https://mhs-webring.netlify.app/onionring-variables.js"></script>
  <script src="https://mhs-webring.netlify.app/onionring-widget.js"></script>
  <div id="mycoolring" class="webring-badge"></div>

  <script>
    const LASTFM_API_KEY = '84bc3dab1c9bd0d7ad3fce0df740d2eb';
    const LASTMFM_USERNAME = 'ksuks1';

    async function getYearlyScrobbles() {
      const CURRENT_YEAR = new Date().getFullYear();
      const from = Math.floor(new Date(CURRENT_YEAR, 0, 1).getTime() / 1000);
      const to = Math.floor(Date.now() / 1000);

      const url = `https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${LASTMFM_USERNAME}&api_key=${LASTFM_API_KEY}&format=json&from=${from}&to=${to}&limit=1`;

      try {
        const response = await fetch(url);
        const data = await response.json();
        const totalTracks = data.recenttracks['@attr'].total;

        document.getElementById('lastfm-stats').textContent = `I listened to ${totalTracks} songs this year`;
      } catch (error) {
        document.getElementById('lastfm-stats').textContent = 'Listening to music...';
        console.error('Error fetching Last.fm data:', error);
      }
    }

    async function getYearlyCommits() {
      const username = "kashsuks";
      const start = new Date(new Date().getFullYear(), 0, 1);
      const end = new Date();

      let totalCommits = 0;
      let page = 1;

      try {
        while (page <= 10) { 
          const url = `https://api.github.com/users/${username}/events/public?per_page=100&page=${page}`;
          const res = await fetch(url, {
            headers: { "Accept": "application/vnd.github+json" },
          });

          if (!res.ok) throw new Error(`GitHub HTTP ${res.status}`);

          const events = await res.json();
          console.log(events);
          if (!Array.isArray(events) || events.length === 0) break;

          let reachedOldEvents = false;

          for (const ev of events) {
            const t = new Date(ev.created_at);

            if (t < start) {
              reachedOldEvents = true;
              break;
            }

            if (ev.type === "PushEvent" && ev.payload) {
              totalCommits += Number(ev.payload.size || 0);
            }
          }

          if (reachedOldEvents) break;
          page++;
        }

        const year = new Date().getFullYear();
        document.getElementById("github-stats").textContent =
          `I made ${totalCommits}${page > 10 ? "+" : ""} commits in ${year}`;
      } catch (err) {
        console.error("Error fetching GitHub data:", err);
        document.getElementById("github-stats").textContent = "Shipping something...";
      }
    }

    getYearlyScrobbles();
    getYearlyCommits();
  </script>
</body>
</html>